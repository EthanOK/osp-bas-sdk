var e=require("@ethereum-attestation-service/eas-sdk"),t=require("@bnb-chain/greenfield-js-sdk"),r=require("ethers"),n=require("@bnb-chain/reed-solomon"),o=function(e){try{return Promise.resolve(e.sp.getStorageProviders()).then(function(e){return(null!=e?e:[]).filter(function(e){return e.endpoint.includes("nodereal")})})}catch(e){return Promise.reject(e)}},i=function(e){return Promise.resolve(o(e)).then(function(e){var t,r=Math.floor(Math.random()*e.length),n=[].concat(e.slice(0,r),e.slice(r+1)).map(function(e){return e.operatorAddress});return{id:e[r].id||0,endpoint:e[r].endpoint,primarySpAddress:null==(t=e[r])?void 0:t.operatorAddress,sealAddress:e[r].sealAddress,secondarySpAddresses:n}})};function s(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}var c=new n.ReedSolomon;function a(e,t){return{name:e,type:"",size:t.byteLength,content:t}}exports.GreenFieldClientTS=/*#__PURE__*/function(){function e(e,r,n){this.client=void 0,this.address=null,this.client=t.Client.create(e,r),this.address=n}var r=e.prototype;return r.createBucket=function(e,r){try{var n=this;return Promise.resolve(i(n.client)).then(function(o){function i(){var i=s(function(){return Promise.resolve(n.client.bucket.createBucket({bucketName:e,creator:n.address,visibility:t.VisibilityType.VISIBILITY_TYPE_PUBLIC_READ,chargedReadQuota:t.Long.fromString("0"),paymentAddress:n.address,primarySpAddress:o.primarySpAddress})).then(function(e){return Promise.resolve(e.simulate({denom:"BNB"})).then(function(t){return Promise.resolve(e.broadcast({denom:"BNB",gasLimit:Number(null==t?void 0:t.gasLimit),gasPrice:(null==t?void 0:t.gasPrice)||"5000000000",payer:n.address,granter:"",privateKey:r})).then(function(e){console.log("transactionHash",e.transactionHash)})})})},function(e){c||console.log(e)});return i&&i.then?i.then(function(){return c}):c}r.startsWith("0x")||(r="0x"+r);var c=!1,a=s(function(){return Promise.resolve(n.client.bucket.getBucketMeta({bucketName:e})).then(function(e){console.log("bucketMeta",e),c=!0})},function(){});return a&&a.then?a.then(i):i()})}catch(e){return Promise.reject(e)}},r.createObject=function(e,r,n,o){void 0===o&&(o=!1);try{var i=this;console.log("started"),n.startsWith("0x")||(n="0x"+n);var s=JSON.parse(r),u=s.message.schema+"."+s.uid,d=Buffer.from(r),l=c.encode(Uint8Array.from(d));return Promise.resolve(i.client.object.createObject({bucketName:e,objectName:u,creator:i.address,visibility:o?t.VisibilityType.VISIBILITY_TYPE_PRIVATE:t.VisibilityType.VISIBILITY_TYPE_PUBLIC_READ,contentType:"json",redundancyType:t.RedundancyType.REDUNDANCY_EC_TYPE,payloadSize:t.Long.fromInt(d.byteLength),expectChecksums:l.map(function(e){return t.bytesFromBase64(e)})})).then(function(t){return Promise.resolve(t.simulate({denom:"BNB"})).then(function(r){return Promise.resolve(t.broadcast({denom:"BNB",gasLimit:Number(r.gasLimit),gasPrice:r.gasPrice,payer:i.address,granter:"",privateKey:n})).then(function(t){var r=t.transactionHash;return console.log("create object success",r),Promise.resolve(i.client.object.uploadObject({bucketName:e,objectName:u,body:a(u,d),txnHash:r},{type:"ECDSA",privateKey:n})).then(function(e){return 0===e.code&&console.log("upload object success",e),r})})})})}catch(e){return Promise.reject(e)}},e}(),exports.createAttestOffChain=function(e,t,r){try{return t.connect(e),Promise.resolve(t.getOffchain()).then(function(t){var n=Math.floor(Date.now()/1e3);return Promise.resolve(t.signOffchainAttestation({recipient:r.recipient,expirationTime:BigInt(0),time:BigInt(n),revocable:!0,version:1,nonce:BigInt(0),schema:r.schemaUID,refUID:r.refUID,data:r.encodedData},e)).then(function(e){return JSON.stringify(e,function(e,t){return"bigint"==typeof t?Number(t).toString():t})})})}catch(e){return Promise.reject(e)}},exports.encodeAddrToBucketName=function(e){return"bas-"+r.hashMessage(r.getAddress(e)).substring(2,42)},exports.getAllSps=function(e){return Promise.resolve(o(e)).then(function(e){return e.map(function(e){var t;return{address:e.operatorAddress,endpoint:e.endpoint,name:null==(t=e.description)?void 0:t.moniker}})})},exports.getSchemaByUID=function(t,r,n){try{var o=new e.SchemaRegistry(r);return o.connect(t),Promise.resolve(o.getSchema({uid:n}))}catch(e){return Promise.reject(e)}},exports.getSps=o,exports.initEAS=function(t,r){new e.EAS(r).connect(t)},exports.registerSchema=function(t,r,n){try{var o=new e.SchemaRegistry(r);return o.connect(t),Promise.resolve(o.register({schema:n.schema,resolverAddress:n.resolverAddress,revocable:n.revocable})).then(function(e){return Promise.resolve(e.wait())})}catch(e){return Promise.reject(e)}},exports.selectSp=i;
//# sourceMappingURL=index.js.map
